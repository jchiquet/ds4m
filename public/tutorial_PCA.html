<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Julien Chiquet" />


<title>Tutorial: PCA on State Budget</title>

<script src="site_libs/header-attrs-2.8/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<script src="resources/hideOutput.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="resources/style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Natixis Certificat for Data Science - Dimension Reduction</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="https://github.com/jchiquet/data_science_HEC">
    <span class="fas fa-github"></span>
     
    github
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="instructions.html">
    <span class="fas fa-gear"></span>
     
    Setup
  </a>
</li>
<li>
  <a href="OverviewDimensionReduction.pdf">
    <span class="fas fa-chalkboard-teacher"></span>
     
    Slides
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-laptop"></span>
     
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="tutorial_PCA.html">PCA</a>
    </li>
    <li>
      <a href="tutorial_nonlinear_methods.html">tSNE- UMAP, Auto-encoders</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-keyboard"></span>
     
    Homework
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="homework_PCA.html">Data analysis with PCA</a>
    </li>
    <li>
      <a href="homework_nonlinear_methods.html">MDS, Kernel-PCA</a>
    </li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Tutorial: PCA on State Budget</h1>
<h4 class="author">Julien Chiquet</h4>
<h4 class="date">Natixis Certificat for Data Science</h4>

</div>


<div id="preliminaries" class="section level1">
<h1>Preliminaries</h1>
<div id="package-requirements" class="section level2">
<h2>Package requirements</h2>
<p>We start by loading a couple of packages for data manipulation, dimension reduction and fancy representations.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)   <span class="co"># advanced data manipulation and vizualisation</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)       <span class="co"># R notebook export and formatting </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FactoMineR)  <span class="co"># Factor analysis</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)  <span class="co"># Fancy plotting of FactoMineR outputs</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)    <span class="co"># Fancy plotting of matrices </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)      <span class="co"># Easy-to-use ggplot2 extensions</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>()) <span class="co"># set default ggplot2 theme to black and white</span></span></code></pre></div>
</div>
<div id="importing-the-data-set" class="section level2">
<h2>Importing the Data set</h2>
<div id="data-description" class="section level3">
<h3>Data description</h3>
<p>We consider a data set inherited from the classical ‘French school’ of data analysis. <!-- This data set is taken from @bouroche1980analyse and has been analyzed e.g. in @duby2006analyse.  --> The data matrix <span class="math inline">\(\mathbf{X} = (x_{ij})_{i=1,\dots,n; j=1,\dots,p}\)</span> contains the distribution of the French State budget between <span class="math inline">\(p = 11\)</span> different items between <span class="math inline">\(n = 24\)</span> years sampled between 1872 and 1971.</p>
<p>The values are given as a percentage of the overall budget and the different items are</p>
<ul>
<li>Government</li>
<li>Agriculture</li>
<li>Business and Industry</li>
<li>Employment</li>
<li>Housing</li>
<li>Education</li>
<li>Welfare</li>
<li>Veterans</li>
<li>Defence</li>
<li>Debt Interest</li>
<li>Others</li>
</ul>
</div>
<div id="data-loading" class="section level3">
<h3>Data loading</h3>
<p>The file <code>budget.csv</code> is available in comma separated format, with <code>;</code> as separator and <code>,</code> as decimal (SOME cumbersome French formatting).</p>
<p><strong>Load the data into a data frame and name the columns appropriately.</strong></p>
<div class="hiddensolution">
<p>The function <code>read_csv2</code> from the <code>readr</code> package, part of the <a href="https://www.tidyverse.org/">tidyverse</a> can hande this automatically. We also specify the column names, corresponding to the budgetary items, plus the corresponding year, while loading the data set into <code>R</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>state_budget <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv2</span>(<span class="st">&quot;data/budget.csv&quot;</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="fu">c</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Governments&quot;</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Agriculture&quot;</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Business and Industry&quot;</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Employment&quot;</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Housing&quot;</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Education&quot;</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Welfare&quot;</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Veterans&quot;</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Defence&quot;</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Debt Interest&quot;</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Others&quot;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    ))</span></code></pre></div>
</div>
</div>
</div>
</div>
<div id="basic-descriptive-analysis" class="section level1">
<h1>Basic descriptive analysis</h1>
<div id="data-table-summary" class="section level2">
<h2>Data table summary</h2>
<p><strong>Have a look at the head of the data table <span class="math inline">\(\mathbf{X}\)</span></strong></p>
<div class="hiddensolution">
<p><code>kable</code> is used adapt the formatting to the type of output: HTML, screen, PDF</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>state_budget <span class="sc">%&gt;%</span> <span class="fu">head</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="3%" />
<col width="9%" />
<col width="9%" />
<col width="17%" />
<col width="8%" />
<col width="6%" />
<col width="7%" />
<col width="6%" />
<col width="7%" />
<col width="6%" />
<col width="11%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">Year</th>
<th align="right">Governments</th>
<th align="right">Agriculture</th>
<th align="right">Business and Industry</th>
<th align="right">Employment</th>
<th align="right">Housing</th>
<th align="right">Education</th>
<th align="right">Welfare</th>
<th align="right">Veterans</th>
<th align="right">Defence</th>
<th align="right">Debt Interest</th>
<th align="right">Others</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1872</td>
<td align="right">18.0</td>
<td align="right">0.5</td>
<td align="right">0.1</td>
<td align="right">6.7</td>
<td align="right">0.5</td>
<td align="right">2.1</td>
<td align="right">2.0</td>
<td align="right">0</td>
<td align="right">26.4</td>
<td align="right">41.5</td>
<td align="right">2.1</td>
</tr>
<tr class="even">
<td align="right">1880</td>
<td align="right">14.1</td>
<td align="right">0.8</td>
<td align="right">0.1</td>
<td align="right">15.3</td>
<td align="right">1.9</td>
<td align="right">3.7</td>
<td align="right">0.5</td>
<td align="right">0</td>
<td align="right">29.8</td>
<td align="right">31.3</td>
<td align="right">2.5</td>
</tr>
<tr class="odd">
<td align="right">1890</td>
<td align="right">13.6</td>
<td align="right">0.7</td>
<td align="right">0.7</td>
<td align="right">6.8</td>
<td align="right">0.6</td>
<td align="right">7.1</td>
<td align="right">0.7</td>
<td align="right">0</td>
<td align="right">33.8</td>
<td align="right">34.4</td>
<td align="right">1.7</td>
</tr>
<tr class="even">
<td align="right">1900</td>
<td align="right">14.3</td>
<td align="right">1.7</td>
<td align="right">1.7</td>
<td align="right">6.9</td>
<td align="right">1.2</td>
<td align="right">7.4</td>
<td align="right">0.8</td>
<td align="right">0</td>
<td align="right">37.7</td>
<td align="right">26.2</td>
<td align="right">2.2</td>
</tr>
<tr class="odd">
<td align="right">1903</td>
<td align="right">10.3</td>
<td align="right">1.5</td>
<td align="right">0.4</td>
<td align="right">9.3</td>
<td align="right">0.6</td>
<td align="right">8.5</td>
<td align="right">0.9</td>
<td align="right">0</td>
<td align="right">38.4</td>
<td align="right">27.2</td>
<td align="right">3.0</td>
</tr>
<tr class="even">
<td align="right">1906</td>
<td align="right">13.4</td>
<td align="right">1.4</td>
<td align="right">0.5</td>
<td align="right">8.1</td>
<td align="right">0.7</td>
<td align="right">8.6</td>
<td align="right">1.8</td>
<td align="right">0</td>
<td align="right">38.5</td>
<td align="right">25.3</td>
<td align="right">1.9</td>
</tr>
</tbody>
</table>
<p>The following function is useful to have a quick look at a data frame a check types of each variables:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(state_budget)</span></code></pre></div>
<pre><code>## Rows: 24
## Columns: 12
## $ Year                    &lt;dbl&gt; 1872, 1880, 1890, 1900, 1903, 1906, 1909, 1912, 1920, 1923, 1926, 1929, 1932, 1935, 1938, …
## $ Governments             &lt;dbl&gt; 18.0, 14.1, 13.6, 14.3, 10.3, 13.4, 13.5, 12.9, 12.3, 7.6, 10.5, 10.0, 10.6, 8.8, 10.1, 15…
## $ Agriculture             &lt;dbl&gt; 0.5, 0.8, 0.7, 1.7, 1.5, 1.4, 1.1, 1.4, 0.3, 1.2, 0.3, 0.6, 0.8, 2.6, 1.1, 1.6, 1.3, 1.5, …
## $ `Business and Industry` &lt;dbl&gt; 0.1, 0.1, 0.7, 1.7, 0.4, 0.5, 0.5, 0.3, 0.1, 3.2, 0.4, 0.6, 0.3, 1.4, 1.2, 10.1, 16.5, 7.0…
## $ Employment              &lt;dbl&gt; 6.7, 15.3, 6.8, 6.9, 9.3, 8.1, 9.0, 9.4, 11.9, 5.1, 4.5, 9.0, 8.9, 7.8, 5.9, 11.4, 12.4, 7…
## $ Housing                 &lt;dbl&gt; 0.5, 1.9, 0.6, 1.2, 0.6, 0.7, 0.6, 0.6, 2.4, 0.6, 1.8, 1.0, 3.0, 1.4, 1.4, 7.6, 15.8, 12.1…
## $ Education               &lt;dbl&gt; 2.1, 3.7, 7.1, 7.4, 8.5, 8.6, 9.0, 9.3, 3.7, 5.6, 6.6, 8.1, 10.0, 12.4, 9.5, 8.8, 8.1, 8.1…
## $ Welfare                 &lt;dbl&gt; 2.0, 0.5, 0.7, 0.8, 0.9, 1.8, 3.4, 4.3, 1.7, 1.8, 2.1, 3.2, 6.4, 6.2, 6.0, 4.8, 4.9, 5.3, …
## $ Veterans                &lt;dbl&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.9, 10.0, 10.1, 11.8, 13.4, 11.3, 5.9, 3.4, 3.4, …
## $ Defence                 &lt;dbl&gt; 26.4, 29.8, 33.8, 37.7, 38.4, 38.5, 36.8, 41.1, 42.4, 29.0, 19.9, 28.0, 27.4, 29.3, 40.7, …
## $ `Debt Interest`         &lt;dbl&gt; 41.5, 31.3, 34.4, 26.2, 27.2, 25.3, 23.5, 19.4, 23.1, 35.0, 41.6, 25.8, 19.2, 18.5, 18.2, …
## $ Others                  &lt;dbl&gt; 2.1, 2.5, 1.7, 2.2, 3.0, 1.9, 2.6, 1.3, 0.2, 0.9, 2.3, 2.0, 0.0, 0.4, 0.0, 0.0, 1.5, 0.0, …</code></pre>
</div>
<p>Each variable (i.e. budget item) takes it value in <span class="math inline">\([0,100]\)</span> (proportion of the current budget). <strong>Propose a plot to summarize the distribution of these proportions</strong></p>
<div class="hiddensolution">
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>state_budget <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Year) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;budget item&quot;</span>, <span class="at">y =</span> <span class="st">&quot;value (proportion)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code></pre></div>
<p><img src="tutorial_PCA_files/figure-html/boxplot-1.png" width="672" /></p>
</div>
<div id="data-transformation" class="section level3">
<h3>Data transformation</h3>
<p><strong>Create a categorical variable (factor) with a couple of level to regroup samples by time interval that you find relevant in history of 20th century. Check that these period are balanced.</strong></p>
<div class="hiddensolution">
<p>We identify 4 historical periods to regroup the ‘Year’ variable (the id of the sample) into four clusters that might be interesting for interpreting the the PCA. We amend our data frame by adding a column encoding this new descriptive variable (that will <em>not</em> be used in the PCA, of course!).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>state_budget <span class="ot">&lt;-</span> state_budget <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Period =</span> <span class="fu">cut</span>(Year, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">1900</span>, <span class="dv">1920</span>, <span class="dv">1947</span>, <span class="cn">Inf</span>), <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;1900&quot;</span>, <span class="st">&quot;[1900, 1920)&quot;</span>, <span class="st">&quot;(1920, 1947]&quot;</span>, <span class="st">&quot;&gt;= 1947&quot;</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
</div>
</div>
</div>
<div id="scatterplotpairs-plot" class="section level2">
<h2>Scatterplot/pairs plot</h2>
<p>When only few variables are at play, plotting the scatterplot or (pairs-to-pairs plot) might help in finding obvious relations.</p>
<p><strong>Use the function <code>scatmat</code> from {GGally} to do that</strong></p>
<div class="hiddensolution">
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>  state_budget <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Year) <span class="sc">%&gt;%</span> <span class="fu">mutate_if</span>(is_double, scale) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    GGally<span class="sc">::</span><span class="fu">scatmat</span>(<span class="at">color =</span> <span class="st">&quot;Period&quot;</span>)</span></code></pre></div>
<p><img src="tutorial_PCA_files/figure-html/scatterplot-1.png" width="768" /></p>
</div>
<p>When many more continuous variables are observed, a quick glance at the redondancy in information may be explored by representing the correlation matrix, optionally regrouped according to similarity (here, hierarchical clustering).</p>
<p><strong>Use the package {corrplot} to check correlations between variables. What do you conclude?</strong></p>
<div class="hiddensolution">
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow  =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>state_budget <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Year, <span class="sc">-</span>Period) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cor</span>() <span class="sc">%&gt;%</span> corrplot<span class="sc">::</span><span class="fu">corrplot</span>()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>state_budget <span class="sc">%&gt;%</span>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Year, <span class="sc">-</span>Period) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cor</span>() <span class="sc">%&gt;%</span> corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="at">method =</span> <span class="st">&quot;color&quot;</span>, <span class="at">order =</span> <span class="st">&quot;hclust&quot;</span>)</span></code></pre></div>
<p><img src="tutorial_PCA_files/figure-html/correlation%20matrix-1.png" width="768" /></p>
<p>It seems that some variables carry the same information: dimension reduction might help. The data is probably living in a smaller space than <span class="math inline">\(p=11\)</span>.</p>
</div>
</div>
</div>
<div id="principal-component-anaysis" class="section level1">
<h1>Principal Component Anaysis</h1>
<div id="performing-pca" class="section level2">
<h2>Performing PCA</h2>
<p>Before performing the PCA, we center (always!) and scale the continuous columns in the data table, in order to give the same weight to items with high or lower percentage.</p>
<p><strong>Form the matrix <span class="math inline">\(\mathbf{X}\)</span> of continuous scaled variables and perform the PCA with {FactoMineR}</strong></p>
<div class="hiddensolution">
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> state_budget <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is_double, scale) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Year, <span class="sc">-</span>Period)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(X) <span class="ot">&lt;-</span> state_budget<span class="sc">$</span>Year</span></code></pre></div>
<pre><code>## Warning: Setting row names on a tibble is deprecated.</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>myPCA <span class="ot">&lt;-</span> FactoMineR<span class="sc">::</span><span class="fu">PCA</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">X          =</span> X,     <span class="co"># the data on which PCA is performed </span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">scale.unit =</span> <span class="cn">FALSE</span>, <span class="co"># scaling has been made &quot;manually&quot;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">graph      =</span> <span class="cn">FALSE</span>, <span class="co"># to make plot right now</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">ncp        =</span> <span class="dv">11</span>     <span class="co"># keep all component </span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    ) </span></code></pre></div>
</div>
<div id="quick-recap-on-pca" class="section level3">
<h3>Quick Recap on PCA</h3>
<p>Recall that, essentially, a PCA and all important quantities is obtained by computing the eigen decomposition of the empirical covariance matrix: <span class="math display">\[\begin{equation*}
  \hat{\boldsymbol \Sigma} = \mathbf{X}^\top \mathbf{X} = \mathbf{V} \boldsymbol{\Lambda} \mathbf{V}^\top.
\end{equation*}\]</span></p>
<p>Equivalently – and this is how it is computed in most program – PCA is obtained by performing the <em>Singular Value Decomposition</em> of the data matrix <span class="math inline">\(\mathbf{X}\)</span>, i.e., <span class="math display">\[\begin{equation*}
  \mathbf{X} = \mathbf{U} \boldsymbol{\Lambda}^{1/2} \mathbf{V}^\top.
\end{equation*}\]</span></p>
<p>We use the following vocabulary:</p>
<ul>
<li>the weights, or rotation matrix, or loadings, is the orthogonal matrix <span class="math inline">\(\mathbf{W} = \mathbf{V}\)</span></li>
<li>the score matrix, or principal components, is the matrix <span class="math inline">\(\mathbf{F} = \mathbf{X}\mathbf{V} = \mathbf{U}\mathbf{\Lambda}^{1/2}\)</span>.</li>
<li>the singular values are stack in the diagonal matrix <span class="math inline">\(\mathbf{\Lambda}^{1/2}\)</span>.</li>
<li>the eigen values <span class="math inline">\(\lambda_j\)</span> of <span class="math inline">\(\boldsymbol\Sigma\)</span> are the square of the singular values of <span class="math inline">\(\mathbf{X}\)</span>.</li>
</ul>
<p>All in all, a PCA is a matrix factorisation such that <span class="math display">\[\begin{equation*}
  \mathbf{F} \mathbf{V}^\top  = \mathbf{X}.
\end{equation*}\]</span></p>
</div>
</div>
<div id="scree-plot" class="section level2">
<h2>Scree plot</h2>
<p>The first diagnostic plot to make is a scree plot, which display the proportion of explained variances by the successive component. Recall that is related to the eigen values of the empirical covariance: <span class="math display">\[\begin{equation*}
  \mathrm{percent}(\mathrm{var}_{j}) = \frac{\lambda_j}{\sum_{j=1}^p \lambda_j}.
\end{equation*}\]</span></p>
<p><strong>Make a scree plot. Comment!</strong></p>
<div class="hiddensolution">
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>factoextra<span class="sc">::</span><span class="fu">fviz_eig</span>(myPCA, <span class="at">addlabels =</span> <span class="cn">TRUE</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>))</span></code></pre></div>
<p><img src="tutorial_PCA_files/figure-html/variances-1.png" width="672" /></p>
<p>Remark that the last 6 axes (&gt; 50% of the number of variables) explain less than 10% of the total variance: this is an important argument toward dimension reduction.</p>
</div>
</div>
<div id="variables-study" class="section level2">
<h2>Variables study</h2>
<p>All information about variables can be reached as follow:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="fu">get_pca_var</span>(myPCA)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>var</span></code></pre></div>
<pre><code>## Principal Component Analysis Results for variables
##  ===================================================
##   Name       Description                                    
## 1 &quot;$coord&quot;   &quot;Coordinates for the variables&quot;                
## 2 &quot;$cor&quot;     &quot;Correlations between variables and dimensions&quot;
## 3 &quot;$cos2&quot;    &quot;Cos2 for the variables&quot;                       
## 4 &quot;$contrib&quot; &quot;contributions of the variables&quot;</code></pre>
<div id="eigen-vector-weights-a.k.a.-loadings" class="section level3">
<h3>Eigen vector / Weights (a.k.a. loadings)</h3>
<p>The eigen vectors of the empirical covariance matrix give weights for obtaining the new variables as a linear combinaison of the original ones.</p>
<p><strong>Check that the right eigen vectors of <span class="math inline">\(\mathbf{X}\)</span>, and the eigen vectors or <span class="math inline">\(\boldsymbol\Sigma\)</span> match with the loadings. Also check that it is orthogonal</strong></p>
<div class="hiddensolution">
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(myPCA<span class="sc">$</span>svd<span class="sc">$</span>V) <span class="do">## eigen(cov(X))$vector</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(V) <span class="ot">&lt;-</span> <span class="fu">dimnames</span>(var<span class="sc">$</span>coord)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(V, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<table>
<colgroup>
<col width="22%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Dim.1</th>
<th align="right">Dim.2</th>
<th align="right">Dim.3</th>
<th align="right">Dim.4</th>
<th align="right">Dim.5</th>
<th align="right">Dim.6</th>
<th align="right">Dim.7</th>
<th align="right">Dim.8</th>
<th align="right">Dim.9</th>
<th align="right">Dim.10</th>
<th align="right">Dim.11</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Governments</td>
<td align="right">-0.078</td>
<td align="right">0.517</td>
<td align="right">0.301</td>
<td align="right">-0.107</td>
<td align="right">-0.404</td>
<td align="right">0.538</td>
<td align="right">0.062</td>
<td align="right">0.332</td>
<td align="right">0.194</td>
<td align="right">-0.072</td>
<td align="right">0.123</td>
</tr>
<tr class="even">
<td align="left">Agriculture</td>
<td align="right">0.367</td>
<td align="right">0.004</td>
<td align="right">0.323</td>
<td align="right">-0.154</td>
<td align="right">0.039</td>
<td align="right">-0.294</td>
<td align="right">0.769</td>
<td align="right">-0.013</td>
<td align="right">0.090</td>
<td align="right">-0.202</td>
<td align="right">0.091</td>
</tr>
<tr class="odd">
<td align="left">Business and Industry</td>
<td align="right">0.374</td>
<td align="right">0.238</td>
<td align="right">-0.125</td>
<td align="right">0.258</td>
<td align="right">-0.180</td>
<td align="right">-0.260</td>
<td align="right">-0.203</td>
<td align="right">-0.245</td>
<td align="right">0.620</td>
<td align="right">0.266</td>
<td align="right">0.254</td>
</tr>
<tr class="even">
<td align="left">Employment</td>
<td align="right">-0.061</td>
<td align="right">0.440</td>
<td align="right">-0.331</td>
<td align="right">0.282</td>
<td align="right">0.650</td>
<td align="right">0.292</td>
<td align="right">0.275</td>
<td align="right">-0.099</td>
<td align="right">0.000</td>
<td align="right">-0.028</td>
<td align="right">0.140</td>
</tr>
<tr class="odd">
<td align="left">Housing</td>
<td align="right">0.324</td>
<td align="right">0.278</td>
<td align="right">-0.339</td>
<td align="right">0.208</td>
<td align="right">-0.312</td>
<td align="right">-0.236</td>
<td align="right">-0.080</td>
<td align="right">0.214</td>
<td align="right">-0.562</td>
<td align="right">-0.287</td>
<td align="right">0.238</td>
</tr>
<tr class="even">
<td align="left">Education</td>
<td align="right">0.353</td>
<td align="right">-0.096</td>
<td align="right">0.374</td>
<td align="right">-0.116</td>
<td align="right">0.377</td>
<td align="right">0.152</td>
<td align="right">-0.474</td>
<td align="right">-0.069</td>
<td align="right">0.025</td>
<td align="right">-0.482</td>
<td align="right">0.291</td>
</tr>
<tr class="odd">
<td align="left">Welfare</td>
<td align="right">0.419</td>
<td align="right">-0.070</td>
<td align="right">0.146</td>
<td align="right">-0.151</td>
<td align="right">0.124</td>
<td align="right">0.233</td>
<td align="right">0.002</td>
<td align="right">0.091</td>
<td align="right">-0.357</td>
<td align="right">0.728</td>
<td align="right">0.202</td>
</tr>
<tr class="even">
<td align="left">Veterans</td>
<td align="right">0.130</td>
<td align="right">-0.564</td>
<td align="right">-0.330</td>
<td align="right">0.203</td>
<td align="right">-0.014</td>
<td align="right">0.262</td>
<td align="right">0.145</td>
<td align="right">0.527</td>
<td align="right">0.292</td>
<td align="right">-0.089</td>
<td align="right">0.233</td>
</tr>
<tr class="odd">
<td align="left">Defence</td>
<td align="right">-0.275</td>
<td align="right">0.151</td>
<td align="right">-0.228</td>
<td align="right">-0.639</td>
<td align="right">0.183</td>
<td align="right">-0.348</td>
<td align="right">-0.083</td>
<td align="right">0.295</td>
<td align="right">0.123</td>
<td align="right">0.075</td>
<td align="right">0.414</td>
</tr>
<tr class="even">
<td align="left">Debt Interest</td>
<td align="right">-0.399</td>
<td align="right">-0.210</td>
<td align="right">0.141</td>
<td align="right">0.180</td>
<td align="right">-0.209</td>
<td align="right">0.080</td>
<td align="right">0.141</td>
<td align="right">-0.410</td>
<td align="right">-0.157</td>
<td align="right">0.009</td>
<td align="right">0.694</td>
</tr>
<tr class="odd">
<td align="left">Others</td>
<td align="right">-0.246</td>
<td align="right">0.078</td>
<td align="right">0.472</td>
<td align="right">0.506</td>
<td align="right">0.219</td>
<td align="right">-0.377</td>
<td align="right">-0.090</td>
<td align="right">0.477</td>
<td align="right">-0.024</td>
<td align="right">0.155</td>
<td align="right">0.058</td>
</tr>
</tbody>
</table>
<p>This is a <em>rotation matrix</em>, and thus an orthogonal matrix:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((<span class="fu">t</span>(V) <span class="sc">-</span> <span class="fu">solve</span>(V))<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 7.690705e-30</code></pre>
</div>
<p>The coordinate of the variables projected on the correlation circle are equal to <span class="math inline">\(\mathbf{V} \sqrt{\mathbf{\Lambda}}\)</span>, the correlation between the new variables and the original ones. Indeed,</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(V)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">diag</span>(myPCA<span class="sc">$</span>svd<span class="sc">$</span>vs)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((V <span class="sc">%*%</span> D <span class="sc">-</span> var<span class="sc">$</span>coord)<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p><strong>Check the contribution of the original variables to the new axis. Comment</strong></p>
<div class="hiddensolution">
<p>The contribution of the original variable to the (e.g first two) components are given in percentage by the field <code>contrib</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_contrib</span>(myPCA, <span class="at">choice =</span> <span class="st">&quot;var&quot;</span>, <span class="at">axes =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="tutorial_PCA_files/figure-html/contrib%20var-1.png" width="672" /></p>
</div>
</div>
<div id="correlation-circle" class="section level3">
<h3>Correlation circle</h3>
<p>The correlation circle gives a quick representation of how new and original variables are related together.</p>
<p><strong>Make the plot, comment! Also check the quality of the representation of the variables</strong></p>
<div class="hiddensolution">
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(var<span class="sc">$</span>cor, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<table>
<colgroup>
<col width="22%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Dim.1</th>
<th align="right">Dim.2</th>
<th align="right">Dim.3</th>
<th align="right">Dim.4</th>
<th align="right">Dim.5</th>
<th align="right">Dim.6</th>
<th align="right">Dim.7</th>
<th align="right">Dim.8</th>
<th align="right">Dim.9</th>
<th align="right">Dim.10</th>
<th align="right">Dim.11</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Governments</td>
<td align="right">-0.173</td>
<td align="right">0.740</td>
<td align="right">0.342</td>
<td align="right">-0.107</td>
<td align="right">-0.340</td>
<td align="right">0.402</td>
<td align="right">0.028</td>
<td align="right">0.118</td>
<td align="right">0.049</td>
<td align="right">-0.013</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Agriculture</td>
<td align="right">0.818</td>
<td align="right">0.005</td>
<td align="right">0.367</td>
<td align="right">-0.154</td>
<td align="right">0.033</td>
<td align="right">-0.219</td>
<td align="right">0.348</td>
<td align="right">-0.005</td>
<td align="right">0.023</td>
<td align="right">-0.038</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Business and Industry</td>
<td align="right">0.833</td>
<td align="right">0.341</td>
<td align="right">-0.142</td>
<td align="right">0.257</td>
<td align="right">-0.151</td>
<td align="right">-0.194</td>
<td align="right">-0.092</td>
<td align="right">-0.087</td>
<td align="right">0.155</td>
<td align="right">0.050</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">Employment</td>
<td align="right">-0.137</td>
<td align="right">0.631</td>
<td align="right">-0.376</td>
<td align="right">0.281</td>
<td align="right">0.547</td>
<td align="right">0.218</td>
<td align="right">0.124</td>
<td align="right">-0.035</td>
<td align="right">0.000</td>
<td align="right">-0.005</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Housing</td>
<td align="right">0.722</td>
<td align="right">0.398</td>
<td align="right">-0.385</td>
<td align="right">0.208</td>
<td align="right">-0.263</td>
<td align="right">-0.176</td>
<td align="right">-0.036</td>
<td align="right">0.076</td>
<td align="right">-0.141</td>
<td align="right">-0.054</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">Education</td>
<td align="right">0.787</td>
<td align="right">-0.137</td>
<td align="right">0.425</td>
<td align="right">-0.115</td>
<td align="right">0.318</td>
<td align="right">0.113</td>
<td align="right">-0.214</td>
<td align="right">-0.025</td>
<td align="right">0.006</td>
<td align="right">-0.090</td>
<td align="right">0.001</td>
</tr>
<tr class="odd">
<td align="left">Welfare</td>
<td align="right">0.933</td>
<td align="right">-0.101</td>
<td align="right">0.166</td>
<td align="right">-0.150</td>
<td align="right">0.104</td>
<td align="right">0.174</td>
<td align="right">0.001</td>
<td align="right">0.032</td>
<td align="right">-0.089</td>
<td align="right">0.136</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Veterans</td>
<td align="right">0.289</td>
<td align="right">-0.807</td>
<td align="right">-0.375</td>
<td align="right">0.202</td>
<td align="right">-0.012</td>
<td align="right">0.196</td>
<td align="right">0.065</td>
<td align="right">0.187</td>
<td align="right">0.073</td>
<td align="right">-0.017</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Defence</td>
<td align="right">-0.612</td>
<td align="right">0.216</td>
<td align="right">-0.260</td>
<td align="right">-0.637</td>
<td align="right">0.154</td>
<td align="right">-0.260</td>
<td align="right">-0.037</td>
<td align="right">0.104</td>
<td align="right">0.031</td>
<td align="right">0.014</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">Debt Interest</td>
<td align="right">-0.889</td>
<td align="right">-0.301</td>
<td align="right">0.160</td>
<td align="right">0.179</td>
<td align="right">-0.176</td>
<td align="right">0.060</td>
<td align="right">0.064</td>
<td align="right">-0.145</td>
<td align="right">-0.039</td>
<td align="right">0.002</td>
<td align="right">0.001</td>
</tr>
<tr class="odd">
<td align="left">Others</td>
<td align="right">-0.548</td>
<td align="right">0.112</td>
<td align="right">0.536</td>
<td align="right">0.505</td>
<td align="right">0.184</td>
<td align="right">-0.282</td>
<td align="right">-0.041</td>
<td align="right">0.169</td>
<td align="right">-0.006</td>
<td align="right">0.029</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(myPCA, <span class="at">col.var =</span> <span class="st">&quot;cos2&quot;</span>, <span class="at">axes =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="tutorial_PCA_files/figure-html/circle-1.png" width="672" /></p>
<p>These quantities measure the correlation between the variabes in the new and the original bases.</p>
<p>The quality of the representation of the original variables by the new ones is measure with the (squared) cosine between them: a high cos2 indicates a good representation of the variable on the principal component.</p>
</div>
</div>
</div>
<div id="indiviual-factor-map" class="section level2">
<h2>Indiviual Factor Map</h2>
<p>All information about variables can ge reached as follow:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="fu">get_pca_ind</span>(myPCA)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>ind</span></code></pre></div>
<pre><code>## Principal Component Analysis Results for individuals
##  ===================================================
##   Name       Description                       
## 1 &quot;$coord&quot;   &quot;Coordinates for the individuals&quot; 
## 2 &quot;$cos2&quot;    &quot;Cos2 for the individuals&quot;        
## 3 &quot;$contrib&quot; &quot;contributions of the individuals&quot;</code></pre>
<div id="the-principal-components-scores" class="section level3">
<h3>The principal components / Scores</h3>
<p>The <em>principal components</em> are the the coordinate of the points in the new basis, after rotating the original data by the matrix of eigen vectors <span class="math inline">\(V\)</span>.</p>
<p><strong>Compute them by yourself and check that it matches the coordinate of the individuals.</strong></p>
<div class="hiddensolution">
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>PC <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(X) <span class="sc">%*%</span> V</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">t</span>(PC[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]), <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="3%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="4%" />
<col width="4%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">1872</th>
<th align="right">1880</th>
<th align="right">1890</th>
<th align="right">1900</th>
<th align="right">1903</th>
<th align="right">1906</th>
<th align="right">1909</th>
<th align="right">1912</th>
<th align="right">1920</th>
<th align="right">1923</th>
<th align="right">1926</th>
<th align="right">1929</th>
<th align="right">1932</th>
<th align="right">1935</th>
<th align="right">1938</th>
<th align="right">1947</th>
<th align="right">1950</th>
<th align="right">1953</th>
<th align="right">1956</th>
<th align="right">1959</th>
<th align="right">1962</th>
<th align="right">1965</th>
<th align="right">1968</th>
<th align="right">1971</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Dim.1</td>
<td align="right">-2.839</td>
<td align="right">-2.709</td>
<td align="right">-2.366</td>
<td align="right">-2.013</td>
<td align="right">-2.289</td>
<td align="right">-1.943</td>
<td align="right">-1.867</td>
<td align="right">-1.401</td>
<td align="right">-2.094</td>
<td align="right">-1.120</td>
<td align="right">-1.639</td>
<td align="right">-1.149</td>
<td align="right">0.265</td>
<td align="right">0.645</td>
<td align="right">-0.394</td>
<td align="right">1.066</td>
<td align="right">2.321</td>
<td align="right">1.178</td>
<td align="right">2.865</td>
<td align="right">2.629</td>
<td align="right">2.99</td>
<td align="right">3.076</td>
<td align="right">3.617</td>
<td align="right">3.171</td>
</tr>
<tr class="even">
<td align="left">Dim.2</td>
<td align="right">1.003</td>
<td align="right">1.970</td>
<td align="right">0.219</td>
<td align="right">0.739</td>
<td align="right">0.163</td>
<td align="right">0.613</td>
<td align="right">0.795</td>
<td align="right">0.752</td>
<td align="right">0.936</td>
<td align="right">-2.822</td>
<td align="right">-2.556</td>
<td align="right">-1.792</td>
<td align="right">-1.918</td>
<td align="right">-2.248</td>
<td align="right">-1.315</td>
<td align="right">2.209</td>
<td align="right">2.130</td>
<td align="right">1.111</td>
<td align="right">0.225</td>
<td align="right">0.136</td>
<td align="right">-0.11</td>
<td align="right">0.303</td>
<td align="right">-0.459</td>
<td align="right">-0.086</td>
</tr>
</tbody>
</table>
<p>This match the coordinate computed by <code>FactoMineR</code>:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">t</span>(ind<span class="sc">$</span>coord[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]), <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="3%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="4%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="3%" />
<col width="4%" />
<col width="4%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">1872</th>
<th align="right">1880</th>
<th align="right">1890</th>
<th align="right">1900</th>
<th align="right">1903</th>
<th align="right">1906</th>
<th align="right">1909</th>
<th align="right">1912</th>
<th align="right">1920</th>
<th align="right">1923</th>
<th align="right">1926</th>
<th align="right">1929</th>
<th align="right">1932</th>
<th align="right">1935</th>
<th align="right">1938</th>
<th align="right">1947</th>
<th align="right">1950</th>
<th align="right">1953</th>
<th align="right">1956</th>
<th align="right">1959</th>
<th align="right">1962</th>
<th align="right">1965</th>
<th align="right">1968</th>
<th align="right">1971</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Dim.1</td>
<td align="right">-2.839</td>
<td align="right">-2.709</td>
<td align="right">-2.366</td>
<td align="right">-2.013</td>
<td align="right">-2.289</td>
<td align="right">-1.943</td>
<td align="right">-1.867</td>
<td align="right">-1.401</td>
<td align="right">-2.094</td>
<td align="right">-1.120</td>
<td align="right">-1.639</td>
<td align="right">-1.149</td>
<td align="right">0.265</td>
<td align="right">0.645</td>
<td align="right">-0.394</td>
<td align="right">1.066</td>
<td align="right">2.321</td>
<td align="right">1.178</td>
<td align="right">2.865</td>
<td align="right">2.629</td>
<td align="right">2.99</td>
<td align="right">3.076</td>
<td align="right">3.617</td>
<td align="right">3.171</td>
</tr>
<tr class="even">
<td align="left">Dim.2</td>
<td align="right">1.003</td>
<td align="right">1.970</td>
<td align="right">0.219</td>
<td align="right">0.739</td>
<td align="right">0.163</td>
<td align="right">0.613</td>
<td align="right">0.795</td>
<td align="right">0.752</td>
<td align="right">0.936</td>
<td align="right">-2.822</td>
<td align="right">-2.556</td>
<td align="right">-1.792</td>
<td align="right">-1.918</td>
<td align="right">-2.248</td>
<td align="right">-1.315</td>
<td align="right">2.209</td>
<td align="right">2.130</td>
<td align="right">1.111</td>
<td align="right">0.225</td>
<td align="right">0.136</td>
<td align="right">-0.11</td>
<td align="right">0.303</td>
<td align="right">-0.459</td>
<td align="right">-0.086</td>
</tr>
</tbody>
</table>
</div>
<p>The individual factor map is the representation of the principal components/scores in the specified axes.</p>
<p><strong>Use {factoextra} to represent the individuals in the new basis, on axes (1,2), (1,3), (2,3). Add some color related to the period. Comment</strong></p>
<div class="hiddensolution">
<p>Here, we change the size of the point according to the quality of their representation (measure with the cosine to the square, just like with variable factor map).</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_ind</span> (myPCA, </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointsize =</span> <span class="st">&quot;cos2&quot;</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointshape =</span> <span class="dv">21</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;#E7B800&quot;</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">repel =</span> <span class="cn">TRUE</span> ,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><img src="tutorial_PCA_files/figure-html/ind%20map-1.png" width="672" /></p>
<p>Let us enrich our plot by the Period, a qualitative variable that we wish related with the budget.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_ind</span> (myPCA, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom.ind =</span> <span class="st">&quot;point&quot;</span>, </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.ind =</span> state_budget<span class="sc">$</span>Period,  </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">&quot;#00AFBB&quot;</span>, <span class="st">&quot;#E7B800&quot;</span>, <span class="st">&quot;#FC4E07&quot;</span>,<span class="st">&quot;#2E9FDF&quot;</span>, <span class="st">&quot;#000000&quot;</span>), </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="st">&quot;Period&quot;</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><img src="tutorial_PCA_files/figure-html/Period-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="biplot" class="section level2">
<h2>Biplot</h2>
<p>When there are only few variables (only tens), it is possible to give an unifying representation of individual and variable factor maps into a single plot, called <em>biplot</em>.</p>
<p><strong>Make the biplot and comment</strong></p>
<div class="hiddensolution">
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_biplot</span> (myPCA, </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom.ind =</span> <span class="st">&quot;point&quot;</span>, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.ind =</span> state_budget<span class="sc">$</span>Period,  </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">&quot;#00AFBB&quot;</span>, <span class="st">&quot;#E7B800&quot;</span>, <span class="st">&quot;#FC4E07&quot;</span>,<span class="st">&quot;#2E9FDF&quot;</span>, <span class="st">&quot;#000000&quot;</span>), </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="st">&quot;Period&quot;</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">axes =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><img src="tutorial_PCA_files/figure-html/biplot-1.png" width="672" /></p>
<p>This plot is especially helpful to identifiy groups of individuals, how the new components are related to the original variables and finally which group individuals is carrying which part of the information/variables.</p>
</div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
